services:
  # Backend service (FastAPI)
  backend:
    build: ./backend
    container_name: alphanote-backend
    restart: always
    volumes:
      # Mount data directory for SQLite persistence
      - ./backend/data:/app/data
    environment:
      # ✅ 正确写法 (只写容器里面的路径)：
      - DATABASE_PATH=/app/data/alphanote.db
      
      # 为了保险，建议加上这一行 (很多代码用这个变量)：
      - DATABASE_URL=sqlite:////app/data/alphanote.db

      - PROGRESS_PATH=/app/data/progress.json
      - LOG_PATH=/app/data/update.log
    networks:
      - alphanote-network
    

  # Frontend service (Nginx + Static files)
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: alphanote-frontend
    restart: always
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - alphanote-network

networks:
  alphanote-network:
    driver: bridge


volumes:
  postgres_data:  # 这一行必须加在文件最底部，用于持久化保存数据
